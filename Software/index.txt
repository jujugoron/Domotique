<!DOCTYPE html>

<head>

  <meta charset="UTF-8">

  <title>Domotique</title>



<!-- CSS init -->



 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">





<!--<link rel="stylesheet" href="CSS/bootstrap.css"> -->

<link rel="stylesheet" href="css/style.css" media="screen" type="text/css" />

<meta charset="utf-8" />

<link rel="stylesheet" href="assets/css/main.css" />

<link rel="stylesheet" href="CSS/master.css">



<!-- date et heure-->



<?php



    // Récupère l'heure du serveur



       $localtime = localtime();

       $seconde =  $localtime[0];

       $minute =  $localtime[1];

       $heure =  $localtime[2];

       $day = $localtime[3];

       $month = $localtime[4]+1;

       $year = $localtime[5]+1900;



?>



<script>

          

          bcle=0;



          function clock()

          {

            if (bcle == 0)

            {

              heure = <?php echo $heure ?>;

              min = <?php echo $minute ?>;

              sec = <?php echo $seconde ?>;

              day = <?php echo $day ?>;

              month = <?php echo $month ?>;

              year = <?php echo $year ?>;

            }

            else

            {

              sec ++;

              if (sec == 60)

              {

                sec=0;

                min++;

                if (min == 60)

                {

                  min=0;

                  heure++;

                };

              };

            };

            txt="";

            if(heure < 10)

            {

              txt += "0";

            }

            txt += heure+ ":";

            if(min < 10)

            {

              txt += "0"

            }

            txt += min + ":";

            if(sec < 10)

            {

              txt += "0"

            }

            txt += sec + " " ;

            if(day < 10)

            {

              txt += "0";

            }

            txt += day+ "/";

            if(month < 10)

            {

              txt += "0";

            }

            txt += month+ "/";

            if(year < 10)

            {

              txt += "0";

            }

            txt += year;



            timer = setTimeout("clock()",1000);

            bcle ++;

            document.clock.date.value = txt ;

          }

          

</script>



<script>

   async function Json(name=0)

          {



  if (name=="state"){

    const response = await fetch('http://192.168.1.81:8080/api/8062FB694A/lights/2');

  const myJson = await response.json(); //extract JSON from the http response

  // do something with myJson

  

  document.consigne.value=myJson.state;

  }



  const response = await fetch('http://192.168.1.81:8080/api/8062FB694A/lights/2');

  const myJson = await response.json(); //extract JSON from the http response

  // do something with myJson

  alert(myJson.state.on);

  //alert('hello');

  document.getElementById("consigne").innerHTML=myJson.state.on;

}



async function Put_Json_false()

          {

  const state = JSON.stringify({on:false});

  const response = await fetch('http://192.168.1.81:8080/api/8062FB694A/lights/2/state',{

    method: 'PUT',

    body: state, // string or object

    headers: {

      'Content-Type': 'application/json'

    }

  });

  const myJson = await response.json(); //extract JSON from the http response

  // do something with myJson

}





async function Put_Json_true()

          {

  const state = JSON.stringify({on:true});

  const response = await fetch('http://192.168.1.81:8080/api/8062FB694A/lights/2/state',{

    method: 'PUT',

    body: state, // string or object

    headers: {

      'Content-Type': 'application/json'

    }

  });

  const myJson = await response.json(); //extract JSON from the http response

  // do something with myJson

}



</script>





<!-- recuperation temperature & humidité -->



<?php

   $Temperature = 0;//json_decode(file_get_contents('http://192.168.1.81:8080/api/8062FB694A/sensors/4'));

   echo("testtttttttttttttt");

   echo($Temperature);

  $TempInt_TH =15.7;

  $HumiditeInt_TH =90;

  $batterie_TH=90;

  /*

  $data = file_get_contents('https://api.meteo-concept.com/api/location/city?token=MON_TOKEN&insee=35238');



  if ($data !== false) {

    $TempInt = json_decode($data)->city;

    $TempInt = json_decode($data)->city;

    print("La ville de {$city->name} ({$city->cp}) a pour coordonnées {$city->latitude},{$city->longitude}.");

  }*/

?>

<button onclick="Put_Json_true()">On</button>

<button onclick="Put_Json_false()">Off</button>

          <div class="buttonNav" >

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-unlock" viewBox="0 0 16 16">

                <path d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z"/>

              </svg>

              <a class="para" onclick="Put_Json" >Commut</a>

          </div>



<!-- recuperation prise -->

<?php



  $Etat_P =true;

  /*

  header('Access-Control-Allow-Origin: *');

  header('Content-Type: application/json; charset=utf-8');

  //header('Content-Length: 327');

  //header('ETag: "c03660b1b4245597a0809aaf7f784db4"');

  $data = file_get_contents('http://192.168.137.49:8080/api/93C230E27A/lights/1/');



  if ($data !== false) {

    $Etat = json_decode($data)->Etat;

    

    print("on : {$Etat->state->on} ");

  }*/

?>



</head>







<body style="background-color:black;">



<div class="container-fluid">

    <div class="row">

        <div class="col-XL-2 col-3">

          <!-- date et heure -->

           <div> <!--  Charge la fonction dans le corps de la page  -->

            <body onLoad="Json()">

              



            <!--  Affiche l'heure  -->

            <form name="clock" onSubmit="0" >

            <output name="date" size="13" readonly class="date">

            </form>

           </div> 



          <div class="buttonNav">

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-unlock" viewBox="0 0 16 16">

                <path d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z"/>

              </svg>

              <a class="para"  href="login.html">Login</a>

          </div>



        </div>



        <div class="col-XL-9 col-9">

          <div>

            <!-- affichage des temperatures-->

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-wifi-off" viewBox="0 2 16 16">

              <path d="M10.706 3.294A12.545 12.545 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c.63 0 1.249.05 1.852.148l.854-.854zM8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065 8.448 8.448 0 0 1 3.51-1.27L8 6zm2.596 1.404.785-.785c.63.24 1.227.545 1.785.907a.482.482 0 0 1 .063.745.525.525 0 0 1-.652.065 8.462 8.462 0 0 0-1.98-.932zM8 10l.933-.933a6.455 6.455 0 0 1 2.013.637c.285.145.326.524.1.75l-.015.015a.532.532 0 0 1-.611.09A5.478 5.478 0 0 0 8 10zm4.905-4.905.747-.747c.59.3 1.153.645 1.685 1.03a.485.485 0 0 1 .047.737.518.518 0 0 1-.668.05 11.493 11.493 0 0 0-1.811-1.07zM9.02 11.78c.238.14.236.464.04.66l-.707.706a.5.5 0 0 1-.707 0l-.707-.707c-.195-.195-.197-.518.04-.66A1.99 1.99 0 0 1 8 11.5c.374 0 .723.102 1.021.28zm4.355-9.905a.53.53 0 0 1 .75.75l-10.75 10.75a.53.53 0 0 1-.75-.75l10.75-10.75z"/>

            </svg>

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-wifi" viewBox="0 2 16 16">

              <path d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.444 12.444 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c2.507 0 4.827.802 6.716 2.164.205.148.49.13.668-.049z"/>

              <path d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.455 9.455 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.576 1.336c.206.132.48.108.653-.065zm-2.183 2.183c.226-.226.185-.605-.1-.75A6.473 6.473 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.407.19.611.09A5.478 5.478 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.61-.091l.016-.015zM9.06 12.44c.196-.196.198-.52-.04-.66A1.99 1.99 0 0 0 8 11.5a1.99 1.99 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .707 0l.707-.707z"/>

            </svg>

            <H1 class="para">etat connexion: <?php echo($Etat_P); ?> <br> </H1>

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-thermometer-half" viewBox="0 0 16 16">

              <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z"/>

              <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>

            </svg>

            <H1 class="para">temperature: </H1><br>

            <p class="para">interieur: <?php echo($TempInt_TH); echo "°C";?></p> <p class="para">exterieur: <?php echo(5); ?></p> <br>

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-moisture" viewBox="0 0 16 16">

              <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5h-2zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a28.458 28.458 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a28.458 28.458 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001L7 1.5zm0 0-.364-.343L7 1.5zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267z"/>

            </svg>

            <p class="para">humidité: <?php echo($HumiditeInt_TH ); echo "%";?></p> 

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill= rgb(255,255,0) class="bi bi-lightning-fill" viewBox="0 2 20 16" style="font-size: 4rem" >

            <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641l2.5-8.5z"></path>

            </svg>

            <p class="para">batterie: <?php echo($batterie_TH );echo "%"; ?></p>

            

          </div>  

          <div>          

            <!-- affichage de l'etat du capteur-->

            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-thermometer-sun" viewBox="0 0 16 16">

              <path d="M5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585A1.5 1.5 0 0 1 5 12.5z"/>

              <path d="M1 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM3.5 1A1.5 1.5 0 0 0 2 2.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0L5 10.486V2.5A1.5 1.5 0 0 0 3.5 1zm5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5zm4.243 1.757a.5.5 0 0 1 0 .707l-.707.708a.5.5 0 1 1-.708-.708l.708-.707a.5.5 0 0 1 .707 0zM8 5.5a.5.5 0 0 1 .5-.5 3 3 0 1 1 0 6 .5.5 0 0 1 0-1 2 2 0 0 0 0-4 .5.5 0 0 1-.5-.5zM12.5 8a.5.5 0 0 1 .5-.5h1a.5.5 0 1 1 0 1h-1a.5.5 0 0 1-.5-.5zm-1.172 2.828a.5.5 0 0 1 .708 0l.707.708a.5.5 0 0 1-.707.707l-.708-.707a.5.5 0 0 1 0-.708zM8.5 12a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5z"/>

            </svg>

            <H1 class="para">Chauffage: </H1><br>

            <p class="para">chauffe: <?php if($Etat_P) echo "ON"; else echo "OFF"; ?></p>

            <p class="para">consigne: <?php echo($TempInt_TH); ?></p>

            

            <span id="consigne"></span>

          </div>  

          

         

        </div>

      </div>

    </div>

  </body>

</html>







